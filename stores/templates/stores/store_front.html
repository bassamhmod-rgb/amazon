{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>{{ store.slug }} | Ø£Ù…Ø§Ø²ÙˆÙ† Ø³ÙˆØ±ÙŠØ§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="{% static 'css/themes/' %}theme{{ store.theme }}.css">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<style>
/* ================= BASE ================= */
body {
    font-family: "Cairo", sans-serif;
    background: var(--soft-bg);
    color: var(--text-dark);
    overflow-x: hidden;
}

.main-header {
    position: sticky;
    top: 0;
    z-index: 100;
}

.brand-title-en { 
    font-size:1.6rem; 
    font-weight:700; 
    color:var(--primary-color); 
}
.brand-title-ar { 
    font-size:0.9rem; 
    font-weight:600; 
    color:var(--text-light); 
}
.brand-subtitle { 
    font-size:0.8rem; 
    color:var(--text-light); 
}

/* ================= HERO ================= */
.hero-section { 
    padding: 3rem 0 2rem; 
    color:#fff; 
}

.store-title-display { 
    font-size:2.4rem; 
    font-weight:700; 
    margin-bottom:1rem;
    word-break: break-word;
}

.hero-text { 
    max-width:32rem; 
    word-break: break-word;
}

.hero-image-placeholder {
    border-radius: 24px;
    overflow: hidden;
    box-shadow: var(--hero-shadow);
    background: radial-gradient(
        circle at top left,
        #FFB400 0,
        rgba(255,180,0,0.2) 30%,
        transparent 60%
    ),
    radial-gradient(
        circle at bottom right,
        #1A2A4A 0,
        rgba(26,42,74,0.2) 35%,
        transparent 70%
    );
}

.hero-image-placeholder img {
    width: 100%;
    height: 100%;
    display: block;
}

/* ================= FORMS ================= */
input.form-control,
select.form-select {
    border-radius: 12px;
    border: 1px solid var(--soft-border);
}

button.btn-primary {
    border-radius: 12px;
}

/* ================= STORE CARD ================= */
.store-card {
    border-radius: 16px;
    padding: 1.1rem 1rem 1.3rem;
}

.store-logo-circle {
    width:60px;
    height:60px;
    border-radius:50%;
    font-weight:700;
    display:flex;
    align-items:center;
    justify-content:center;
    margin:0 auto 0.7rem;
}

/* ================= OTHER ================= */
.notice-box {
    border-radius:12px;
    padding:1rem;
}

.main-footer {
    padding: 1.5rem 0;
    margin-top: 2rem;
}

.product-image-square{
    width: min(200px, 100%);
    aspect-ratio: 1 / 1;
    height: auto;
    display:flex;
    align-items:center;
    justify-content:center;
    margin: 0 auto 0.7rem;
    border-radius:14px;
    background: transparent;
    overflow: hidden;
}

.product-image-square img{
    width: 100%;
    height: 100%;
    object-fit: contain;
    object-position: center;
    display:block;
}

.main-header {
    z-index: 2000;
}

.dropdown-menu {
    z-index: 3000;
}
</style>
</head>

<body>

<header class="main-header">
    <div class="container py-2 d-flex justify-content-between align-items-center">

        <div>
            <a href="{% url 'core:index' %}" class="brand-title-en" style="text-decoration:none;">
                Amazon Syria
            </a><br>
            <span class="brand-title-ar">Ø£Ù…Ø§Ø²ÙˆÙ† Ø³ÙˆØ±ÙŠØ§</span><br>
            <span class="brand-subtitle">Ù…Ù†ØµØ© Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙÙŠ Ø³ÙˆØ±ÙŠØ§</span>
        </div>

        <div class="d-flex align-items-center gap-3">

            <a href="{% url 'cart:cart_detail' store.slug %}" class="btn btn-outline-primary">
                ğŸ›’
            </a>

            <a href="{% url 'accounts:customer_points' store.slug %}" class="btn btn-outline-primary">
                ğŸ’°
            </a>

            <div class="dropdown d-md-none">
                <button class="btn btn-outline-primary dropdown-toggle" 
                        type="button" 
                        id="mobileMenuBtn" 
                        data-bs-toggle="dropdown" 
                        aria-expanded="false">
                    â˜°
                </button>
                
                <ul class="dropdown-menu dropdown-menu-end text-end">
                    {% if customer %}
                    <li>
                        <a class="dropdown-item" href="{% url 'orders:customer_orders' store.slug %}">
                            ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ
                        </a>
                    </li>
                    {% endif %}

                    {% if is_owner %}
                    <li>
                        <a class="dropdown-item" href="/dashboard/{{ store.slug }}/">
                            âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                        </a>
                    </li>
                    <li>
                        <span class="dropdown-item-text">
                            ğŸšš Ø·Ù„Ø¨Ø§Øª Ù„Ù„ØªØ±Ø­ÙŠÙ„ ({{ unexported_orders_count }})
                        </span>
                    </li>
                    {% endif %}

                    {% if customer %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item text-danger"
                           href="{% url 'accounts:customer_logout' %}?next={{ request.path }}">
                            ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>

            {% if customer %}
                <a href="{% url 'accounts:customer_logout' %}?next={{ request.path }}"
                   class="btn btn-outline-danger d-none d-md-inline">
                    ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
                </a>
            {% endif %}
            
            {% if is_owner %}
                <a href="/dashboard/{{ store.slug }}/" class="btn btn-outline-danger d-none d-md-inline">
                    âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </a>
                
                {% if unexported_orders_count > 0 %}
                    <span class="badge bg-danger fs-6 d-none d-md-inline">
                        ğŸšš Ø·Ù„Ø¨Ø§Øª Ù„Ù„ØªØ±Ø­ÙŠÙ„ ({{ unexported_orders_count }})
                    </span>
                {% else %}
                    <span class="badge bg-secondary fs-6 d-none d-md-inline">
                        ğŸšš Ø·Ù„Ø¨Ø§Øª Ù„Ù„ØªØ±Ø­ÙŠÙ„ (0)
                    </span>
                {% endif %}
            {% endif %}
        </div>
    </div>
</header>

<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">

            <div class="col-md-6 mb-4">
                <div class="store-title-display">{{ store.slug }}</div>
                <h1 class="hero-title">{{ store.description }}</h1>
                <p class="hero-text">{{ store.description2 }}</p>

                <form method="get" class="mt-3">
                    <input type="text" name="q" value="{{ q }}" class="form-control mb-2"
                           placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">

                    <div class="row g-2">
                        <div class="col-6">
                            <select name="category" class="form-select">
                                <option value="">â€” Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€”</option>
                                {% for c in categories %}
                                    <option value="{{ c.id }}"
                                        {% if c.id|stringformat:"s" == current_category %}selected{% endif %}>
                                        {{ c.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="col-6">
                            <select name="category2" class="form-select">
                                <option value="">â€” Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© â€”</option>
                                {% for c in categories %}
                                    <option value="{{ c.id }}"
                                        {% if c.id|stringformat:"s" == current_category2 %}selected{% endif %}>
                                        {{ c.name }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <button class="btn btn-primary mt-3">Ø¨Ø­Ø«</button>
                </form>
            </div>

            <div class="col-md-6">
                <div class="hero-image-placeholder"
                     style="height: {{ store.hero_height }}px;">
                    {% if store.logo %}
                        <img src="{{ store.logo.url }}"
                             style="object-fit: {{ store.hero_fit }};">
                    {% else %}
                        <img src="https://via.placeholder.com/600x350">
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</section>

<section class="stores-section">
    <div class="container text-center">

        <h2 class="section-title">{{ store.description3 }}</h2>
        <p class="section-subtitle">{{ store.description4 }}</p>

        <div class="row g-3 mt-3">
            {% for p in products %}
            <div class="col-6 col-md-3">
                <div class="store-card">

                    {% if p.main_image %}
                        <div class="product-image-square">
                            <img src="{{ p.main_image.url }}" alt="{{ p.name }}">
                        </div>
                    {% else %}
                        <div class="store-logo-circle">
                            {{ p.name|slice:":2" }}
                        </div>
                    {% endif %}

                    <div class="store-name">{{ p.name }}</div>

                    {% if p.real_stock > 0 %}
                        <div class="text-success fw-bold" style="font-size:0.85rem;">âœ” Ù…ØªÙˆÙØ±</div>
                    {% else %}
                        <div class="text-danger fw-bold" style="font-size:0.85rem;">âœ˜ ØºÙŠØ± Ù…ØªÙˆÙØ±</div>
                    {% endif %}

                    <a href="{% url 'stores:product_public' store.slug p.id %}"
                       class="btn btn-outline-primary mt-2">
                        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬
                    </a>
                </div>
            </div>
            {% empty %}
                <p class="text-muted mt-3">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
            {% endfor %}
        </div>

        <div class="notice-box mt-4">
            {{ store.description5 }}
        </div>
    </div>
</section>

<footer class="main-footer">
    <div class="container text-center">
        Â© <span id="year"></span> Amazon Syria â€“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>