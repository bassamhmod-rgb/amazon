{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <title>{{ store.slug }} | Ø£Ù…Ø§Ø²ÙˆÙ† Ø³ÙˆØ±ÙŠØ§</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… -->
    <link rel="stylesheet" href="{% static 'css/themes/' %}theme{{ store.theme }}.css">

    <!-- Ø®Ø·ÙˆØ· + Ø¨ÙˆØªØ³ØªØ±Ø§Ø¨ -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

    <style>
    body {
        font-family: "Cairo", sans-serif;
        background: var(--soft-bg);
        color: var(--text-dark);
        overflow-x: hidden; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„ØµÙØ­Ø© ÙƒÙ„Ù‡Ø§ Ù…Ù† Ø§Ù„ØªÙ…Ø¯Ø¯ ÙŠÙ…ÙŠÙ† */
    }

    /* HEADER */
    .main-header {
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .brand-title-en { font-size:1.6rem; font-weight:700; color:var(--primary-color); }
    .brand-title-ar { font-size:0.9rem; font-weight:600; color:var(--text-light); }
    .brand-subtitle { font-size:0.8rem; color:var(--text-light); }

    /* HERO */
    .hero-section { padding: 3rem 0 2rem; color:#fff; }

    .store-title-display { 
        font-size:2.4rem; 
        font-weight:700; 
        margin-bottom:1rem;
        word-break: break-word;  /* Ù…Ù†Ø¹ ØªÙˆØ³Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„ */
        overflow-wrap: break-word;
    }

    .hero-text { 
        max-width:32rem; 
        word-break: break-word; /* Ù†ÙØ³ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ù‡ÙˆÙ† */
        overflow-wrap: break-word;
    }

    .hero-image-placeholder {
        border-radius: 24px;
        overflow: hidden;
        height: 350px;
        box-shadow: var(--hero-shadow);
    }

    /* SEARCH */
    input.form-control,
    select.form-select {
        border-radius: 12px;
        border: 1px solid var(--soft-border);
        box-shadow: none;
    }

    button.btn-primary {
        border-radius: 12px;
        padding: 0.45rem 1rem;
    }

    /* PRODUCTS */
    .store-card {
        border-radius: 16px;
        padding: 1.1rem 1rem 1.3rem;
        transition: 0.22s;
    }

    .store-logo-circle {
        width:60px; height:60px;
        border-radius:50%;
        font-weight:700;
        display:flex;
        align-items:center;
        justify-content:center;
        margin:0 auto 0.7rem;
    }

    .store-name { font-weight:700; }
    .store-category { font-size:.85rem; }

    .btn-outline-primary { border-radius:12px; }

    .notice-box {
        border-radius:12px;
        padding:1rem;
    }

    .main-footer {
        padding: 1.5rem 0;
        margin-top: 2rem;
    }

    .product-thumb {
        width: 100%;
        height: 120px;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .product-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    @media (max-width: 768px) {

        .sidebar {
            position: fixed;
            right: -260px;
            top: 0;
            height: 100%;
            width: 260px;
            transition: 0.3s;
            z-index: 9999;
        }

        .sidebar.active {
            right: 0;
        }

        .content {
            margin-right: 0 !important;
            width: 100% !important;
        }

        .container, .dashboard-container {
            max-width: 100% !important;
            width: 100% !important;
            padding-left: 10px;
            padding-right: 10px;
        }

        /* Ø£Ù‡Ù… Ø¥ØµÙ„Ø§Ø­ Ù„Ù„Ù‡Ø§ØªÙ â€” ÙƒØ³Ø± Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø·ÙˆÙŠÙ„Ø© */
        h1, h2, h3, p, .store-title-display, .hero-text {
            word-break: break-word !important;
            overflow-wrap: break-word !important;
        }
    }
</style>
</head>

<body>
<header class="main-header">
    <div class="container py-2 d-flex justify-content-between align-items-center">

        <!-- ğŸ”µ Ù„ÙˆØ¬Ùˆ Ø£Ù…Ø§Ø²ÙˆÙ† Ø³ÙˆØ±ÙŠØ§ -->
        <div>
            <a href="{% url 'core:index' %}" class="brand-title-en" style="text-decoration:none; color:inherit;">
                Amazon Syria
            </a><br>
            <span class="brand-title-ar">Ø£Ù…Ø§Ø²ÙˆÙ† Ø³ÙˆØ±ÙŠØ§</span><br>
            <span class="brand-subtitle">Ù…Ù†ØµØ© Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙÙŠ Ø³ÙˆØ±ÙŠØ§</span>
        </div>

        <!-- ğŸ”´ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø£ÙŠÙ…Ù† (Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… / Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²Ø¨ÙˆÙ† / ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ù„Ø³Ù„Ø©) -->
        <div class="d-flex align-items-center gap-3">

            <!-- ğŸ›’ Ø²Ø± Ø§Ù„Ø³Ù„Ø© (Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙŠØ¸Ù‡Ø±) -->
            <a href="{% url 'cart:cart_detail' store.slug %}" 
                class="cart-btn-theme">
                    ğŸ›’ 
            </a>
           {% if customer %}
             <a href="{% url 'orders:customer_orders' store.slug %}" 
                   class="btn btn-outline-primary"
                    style="border-radius:12px;">
                    ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ
              </a>
              {% endif %}



            {% if is_owner %}
                <!-- âš™ï¸ Ø§Ù„ØªØ§Ø¬Ø± Ø¯Ø§Ø®Ù„ -->
                <a href="/dashboard/{{ store.slug }}/" class="btn btn-warning" style="border-radius:12px;">
                    âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </a>

            {% else %}
                {% if customer %}
                    <!-- â­ Ø§Ù„Ø²Ø¨ÙˆÙ† Ø¯Ø§Ø®Ù„ -->
                    <div class="customer-points-box" style="min-width: 260px;">

                        <div class="welcome-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                Ø£Ù‡Ù„Ø§Ù‹ {{ customer.name }}
                            </div>
                            <a href="{% url 'accounts:customer_logout' %}" style="font-size: 0.9em; text-decoration: none;">
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                            </a>
                        
                        </div>

                        <div class="points-title">
                            Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: {{ balance }} Ù†Ù‚Ø·Ø©
                        </div>

                        <p>
                            ÙŠÙ…ÙƒÙ†Ùƒ Ø²ÙŠØ§Ø¯Ø© Ø±ØµÙŠØ¯Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø´Ø±Ø§Ø¡ 
                            Ø£Ùˆ Ø¯Ø¹ÙˆØ© Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ù„Ù„ØªØ³ÙˆÙ‚ Ù…Ù† Ù…ØªØ¬Ø± {{ store.slug }}.
                        </p>

                    </div>
                {% else %}

                    <!-- ğŸ” Ø§Ù„Ø²Ø§Ø¦Ø± -->
                    <div style="text-align: right; direction: rtl;">
                         <a href="{% url 'accounts:customer_login' store.slug %}?next={{ request.path }}"
                            class="btn btn-primary"
                            style="padding:0.45rem 1.2rem; border-radius:10px; display: block; width: 100%;">
                            ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
                        </a>

                        
                    </div>

                {% endif %}
            {% endif %}

        </div>
    </div>
</header>

<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">

            <div class="col-md-6 mb-4">
                <div class="store-title-display">{{ store.slug }}</div>

                <h1 class="hero-title">{{ store.description }}</h1>
                <p class="hero-text">{{ store.description2 }}</p>

<form method="get" class="mt-3">

    <!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ (Ø¹Ø±Ø¶ ÙƒØ§Ù…Ù„) -->
    <div class="mb-2">
        <input type="text"
               name="q"
               value="{{ q }}"
               class="form-control"
               placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬...">
    </div>

    <!-- ğŸŸ¦ Ø§Ù„ÙØ¦ØªÙŠÙ† Ø¬Ù†Ø¨ Ø¨Ø¹Ø¶ -->
    <div class="row g-2">

        <!-- Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
        <div class="col-6">
            <select name="category" class="form-select">
                <option value="">â€” Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â€”</option>
                {% for c in categories %}
                    <option value="{{ c.id }}"
                        {% if c.id|stringformat:"s" == current_category %}selected{% endif %}>
                        {{ c.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© -->
        <div class="col-6">
            <select name="category2" class="form-select">
                <option value="">â€” Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© â€”</option>
                {% for c in categories %}
                    <option value="{{ c.id }}"
                        {% if c.id|stringformat:"s" == current_category2 %}selected{% endif %}>
                        {{ c.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

    </div>

    <!-- Ø²Ø± Ø§Ù„Ø¨Ø­Ø« -->
    <button class="btn btn-primary mt-3">Ø¨Ø­Ø«</button>

</form>

            </div>

            <div class="col-md-6">
                <div class="hero-image-placeholder">
                    {% if store.logo %}
                        <img src="{{ store.logo.url }}" alt="">
                    {% else %}
                        <img src="https://via.placeholder.com/600x350">
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
</section>

<section id="stores" class="stores-section">
    <div class="container text-center">

        <h2 class="section-title">{{ store.description3 }}</h2>
        <p class="section-subtitle">{{ store.description4 }}</p>

        <div class="row g-3 mt-3">
            {% for p in products %}
            <div class="col-6 col-md-3">
                <div class="store-card">

                    {% if p.main_image %}
                    <div class="product-thumb">
                        <img src="{{ p.main_image.url }}" alt="{{ p.name }}">
                    </div>
                    {% else %}
                    <div class="store-logo-circle">
                    {{ p.name|slice:":2" }}
                    </div>
                    {% endif %}


                    <div class="store-name">{{ p.name }}</div>
                    <div class="store-category">{{ p.description|default:"Ù…Ù†ØªØ¬" }}</div>
                    {% if p.real_stock > 0 %}
                    <div class="text-success fw-bold" style="font-size: 0.85rem;">âœ” Ù…ØªÙˆÙØ±</div>
                    {% else %}
                     <div class="text-danger fw-bold" style="font-size: 0.85rem;">âœ˜ ØºÙŠØ± Ù…ØªÙˆÙØ±</div>
                    {% endif %}


                    <a href="{% url 'stores:product_public' store.slug p.id %}"
                       class="btn btn-outline-primary mt-2">
                        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬
                    </a>

                </div>
            </div>
            {% empty %}
                <p class="text-muted mt-3">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>
            {% endfor %}
        </div>

        <div class="notice-box mt-4">
            {{ store.description5 }}
        </div>

    </div>
</section>

<footer class="main-footer">
    <div class="container d-flex flex-column flex-md-row justify-content-between">
        <div>Â© <span id="year"></span> Amazon Syria â€“ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.</div>
    </div>
</footer>

<script>
    document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
