{% load static %}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨ â€“ {{ store.name }}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">

    <style>
        body {
            background:#f7f9fc;
            font-family:"Cairo",sans-serif;
        }

        .checkout-box {
            background:#fff;
            padding:22px;
            border-radius:14px;
            box-shadow:0 4px 14px rgba(0,0,0,0.08);
            max-width:820px;
            margin:auto;
        }

        .payment-details-box {
            background:#f8f9fc;
            border:1px solid #e1e4eb;
            padding:14px;
            border-radius:10px;
            display:none;
        }

        .method-option {
            border:1px solid #dcdcdc;
            padding:10px 14px;
            border-radius:10px;
            cursor:pointer;
            transition:0.2s;
        }

        .method-option:hover {
            background:#f3f6ff;
        }

        .proof-box {
            background:#f1f6ff;
            border:1px solid #cdd9f1;
            padding:14px;
            border-radius:10px;
            margin-top:15px;
            display:none;
        }

        /* â­ ØµÙ†Ø¯ÙˆÙ‚ Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ø³Ø¨Ù‚Ø© */
        #partialInfoBox {
            background:#fff9e6;
            border:1px solid #ffe29a;
            padding:10px 14px;
            border-radius:10px;
            display:none;
            margin-top:10px;
        }
    </style>
</head>

<body>

<div class="container mt-4 mb-5">

    <h2 class="mb-3 text-center">ğŸ›’ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨</h2>

    <div class="checkout-box">

        {% if error_message %}
           <div class="alert alert-danger">{{ error_message }}</div>
        {% endif %}

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- =================== 1) Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† =================== -->
            <h5 class="mb-3">ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ†</h5>

            <div class="mb-3">
               <label class="form-label">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
               <input type="text" name="customer_name" class="form-control" value="{{ customer.name }}"required>
            </div>

            <div class="mb-3">
                <label class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input type="text" name="customer_phone" class="form-control"
                       value="{{ customer.phone }}">
            </div>

            <div class="mb-3">
                <label class="form-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                <input type="text" name="customer_address" class="form-control"
                       placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ù‡Ù†Ø§"
                       value="{% if checkout_data %}{{ checkout_data.customer_address }}{% endif %}"required>
            </div>

            <textarea name="customer_note" rows="2" class="form-control">
                 {% if checkout_data.customer_note %}{{ checkout_data.customer_note }}{% endif %}
           </textarea>

            <hr class="my-4">

            <!-- =================== 2) ÙƒÙŠÙÙŠØ© Ø§Ù„Ø¯ÙØ¹ =================== -->
            <h5 class="mb-3">ğŸ’° Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</h5>

            <select name="payment_type" id="payment_type" class="form-select mb-3" required>
                <option value="">â€” Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ â€”</option>

                {% if store.allow_full_payment %}
                    <option value="full">ØªØ­ÙˆÙŠÙ„ ÙƒØ§Ù…Ù„ Ø§Ù„Ù…Ø¨Ù„Øº</option>
                {% endif %}

                {% if store.allow_partial_payment %}
                    <option value="partial">Ø¯ÙØ¹Ø© Ù…Ø³Ø¨Ù‚Ø© + Ø¨Ø§Ù‚ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
                {% endif %}

                {% if store.allow_cash_on_delivery %}
                    <option value="cod">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</option>
                {% endif %}
            </select>

            <!-- â­ ØµÙ†Ø¯ÙˆÙ‚ Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ø³Ø¨Ù‚Ø© -->
            <div id="partialInfoBox">
                <strong>âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong><br>
                ÙŠÙÙ†ØµÙØ­ Ø£Ù† Ù„Ø§ ØªÙ‚Ù„ Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¹Ù†:
                <span class="fw-bold text-danger">
                    {{ required_amount|floatformat:2 }} $
                </span>
                ({{ required_percent }}%)
            </div>

            <!-- =================== 3) Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ =================== -->
            <h5 class="mb-3 mt-4">ğŸ’³ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h5>

            {% for method in payment_methods %}
                <div class="method-option mb-2">
                    <input type="radio" name="payment_method" value="{{ method.id }}" 
                           id="method{{ method.id }}" class="form-check-input me-2"
                           onclick="showDetails({{ method.id }})">

                    <label for="method{{ method.id }}" class="form-check-label">
                        {{ method.name }}
                    </label>
                </div>

                <div id="details{{ method.id }}" class="payment-details-box mb-3">
                    {% if method.recipient_name %}
                        <p class="mb-1"><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…:</strong> {{ method.recipient_name }}</p>
                    {% endif %}
                    {% if method.phone_number %}
                        <p class="mb-1"><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> {{ method.phone_number }}</p>
                    {% endif %}
                    {% if method.account_number %}
                        <p class="mb-1"><strong>Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ / Ø§Ù„Ù…Ø­ÙØ¸Ø©:</strong> {{ method.account_number }}</p>
                    {% endif %}
                    {% if method.additional_info %}
                        <p class="mb-1"><strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:</strong> {{ method.additional_info }}</p>
                    {% endif %}
                </div>
            {% endfor %}

            <!-- =================== 4) Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ =================== -->
            <div id="proofBox" class="proof-box">
                <h5 class="mb-3">ğŸ“¸ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹</h5>

                <div class="mb-3">
                    <label class="form-label">Ø±ÙØ¹ ØµÙˆØ±Ø© Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
                    <input type="file" name="payment_proof_image" class="form-control">
                </div>

                <div class="mb-3">
                    <label class="form-label">Ø£Ùˆ Ø±Ù‚Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¯ÙØ¹</label>
                    <input type="text" name="payment_transaction_id" class="form-control"
                           placeholder="Ù…Ø«Ø§Ù„: 9853721">
                </div>

                <small class="text-muted">
                    Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±ÙŠÙ† Ù…Ø·Ù„ÙˆØ¨ Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª ØªØ­ÙˆÙŠÙ„ ÙƒØ§Ù…Ù„ Ø£Ùˆ Ø¯ÙØ¹Ø© Ù…Ø³Ø¨Ù‚Ø©.
                </small>
            </div>

            <hr class="my-4">

            <button class="btn btn-primary w-100 py-2">
                Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
            </button>

        </form>

    </div>
</div>

<script>

    function showDetails(id) {
        document.querySelectorAll('.payment-details-box')
            .forEach(b => b.style.display = 'none');

        const box = document.getElementById("details" + id);
        if (box) box.style.display = 'block';
    }

    // â­ Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ + Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ø³Ø¨Ù‚Ø©
    const paymentTypeSelect = document.getElementById("payment_type");
    const proofBox = document.getElementById("proofBox");
    const partialInfo = document.getElementById("partialInfoBox");

    paymentTypeSelect.addEventListener("change", function () {

        if (this.value === "full" || this.value === "partial") {
            proofBox.style.display = "block";
        } else {
            proofBox.style.display = "none";
        }

        // â­ Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ø¯ÙØ¹Ø© Ø§Ù„Ù…Ø³Ø¨Ù‚Ø© ÙÙ‚Ø· ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¬Ø²Ø¦ÙŠ
        if (this.value === "partial") {
            partialInfo.style.display = "block";
        } else {
            partialInfo.style.display = "none";
        }
    });

</script>

</body>
</html>
